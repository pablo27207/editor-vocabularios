{% extends 'base.html' %}

{% block content %}
<div class="mb-6">
    <h1 class="text-3xl font-bold mt-2 text-slate-800 dark:text-white">{{ _('Gestión de Usuarios') }}</h1>
    <p class="text-gray-600 dark:text-gray-400">{{ _('Administra roles y permisos de usuarios.') }}</p>
    <div class="flex justify-between items-center mt-2">
        <a href="{{ url_for('admin.dashboard') }}" class="text-blue-600 dark:text-blue-400 hover:underline text-sm">
            ← {{ _('Volver al panel de administración') }}
        </a>
        <a href="{{ url_for('admin.user_create_form') }}"
            class="px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded transition-colors">
            + {{ _('Crear nuevo usuario') }}
        </a>
    </div>
</div>

{% with messages = get_flashed_messages() %}
{% if messages %}
<div class="alert-success mb-4">
    {% for message in messages %}
    <p>{{ message }}</p>
    {% endfor %}
</div>
{% endif %}
{% endwith %}

<div class="panel-container">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-neutral-700">
        <thead class="bg-gray-50 dark:bg-neutral-900">
            <tr>
                <th class="table-header-cell">{{ _('Email') }}</th>
                <th class="table-header-cell">{{ _('Nombre') }}</th>
                <th class="table-header-cell">{{ _('Organización') }}</th>
                <th class="table-header-cell">{{ _('Rol') }}</th>
                <th class="table-header-cell">{{ _('Registrado') }}</th>
            </tr>
        </thead>
        <tbody class="bg-white dark:bg-neutral-800 divide-y divide-gray-200 dark:divide-neutral-700">
            {% for user in users %}
            <tr class="hover:bg-slate-50 dark:hover:bg-neutral-700/50 cursor-pointer transition-colors"
                onclick="window.location='{{ url_for('admin.user_detail', user_id=user.id) }}'">
                <td class="table-cell font-medium">
                    <a href="{{ url_for('admin.user_detail', user_id=user.id) }}"
                        class="text-blue-600 dark:text-blue-400 hover:underline" onclick="event.stopPropagation()">
                        {{ user.email }}
                    </a>
                </td>
                <td class="table-cell text-gray-700 dark:text-gray-300">
                    {{ user.name }} {{ user.last_name or '' }}
                </td>
                <td class="table-cell text-gray-500 dark:text-gray-400">
                    {{ user.organization or '-' }}
                </td>
                <td class="table-cell">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                        {% if user.role == 'admin' %}
                        bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200
                        {% elif user.role == 'reviewer' %}
                        bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200
                        {% elif user.role == 'editor' %}
                        bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200
                        {% else %}
                        bg-slate-200 text-slate-700 dark:bg-slate-600 dark:text-slate-200
                        {% endif %}
                    ">
                        {{ user.role }}
                    </span>
                </td>
                <td class="table-cell text-gray-500 dark:text-gray-400">
                    {{ user.created_at.strftime('%Y-%m-%d') }}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                    {{ _('No hay usuarios registrados.') }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="mt-8 p-4 bg-gray-50 dark:bg-neutral-800 rounded-sm border border-gray-200 dark:border-neutral-700">
    <h3 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">{{ _('Descripción de Roles') }}</h3>
    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
        <li><span class="font-medium text-purple-600 dark:text-purple-400">admin</span>: {{ _('Acceso total, gestión de
            usuarios y aprobación de cambios.') }}</li>
        <li><span class="font-medium text-blue-600 dark:text-blue-400">reviewer</span>: {{ _('Puede aprobar/rechazar
            cambios y editar términos directamente.') }}</li>
        <li><span class="font-medium text-green-600 dark:text-green-400">editor</span>: {{ _('Puede proponer cambios que
            requieren aprobación.') }}</li>
        <li><span class="font-medium text-gray-600 dark:text-gray-400">viewer</span>: {{ _('Solo puede ver vocabularios
            (rol por defecto).') }}</li>
    </ul>
</div>
{% endblock %}